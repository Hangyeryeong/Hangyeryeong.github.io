---
title: "OSPF Stub, NSSA, Virtual-link, /32 -> /24"

tags:
 - [Server]
category: L3.IPv4.Routing

toc: true
toc_sticky: true

date: 2022-12-30
last_modified_at: 2022-12-30

#img: ":aws 1.png"

---

<!-- outline-start -->


### OSPF Stub / 완전 Stub <br/>

- `Stub` : 항상 끝에 있는 라우터를 스텁 라우터라고 함.<br/>
스텁 = 끝에 있는 것.<br/><br/>

사진첨부
<br/><br/>

#### Stub 명령어<br/>

R1)<br/>
```yaml
router ospf 1
area 1 stub
```
<br/><br/>

R2)<br/>
```yaml
router ospf 1
area 1 stub
```
<br/><br/>

#### 결과<br/>

외부경로는 모두 다 차단하고 대신 R2가 자동으로 0.0.0.0만 준다. (0.0.0.0이 자동으로 생성됨)<br/><br/>

R1)<br/>

사진첨부
<br/>
0.0.0.0이 자동으로 생성된 것을 확인할 수 있다.<br/>
여기서 외부 경로 = 4.4.4.4<br/>
ping은 역시 다 감.<br/><br/>

### 완전 Stub<br/>

: 모두 다 차단 한다는 뜻.<br/>
ping은 역시 다 감.<br/><br/>

#### 명령어<br/>

R1)<br/>
```yaml
router ospf 1
area 1 stub
```
<br/><br/>

R2)<br/>
```yaml
router ospf 1
area 1 stub no-summary
```
<br/><br/>

#### 결과<br/>

R1)<br/>

사진첨부
<br/><br/>

사진첨부
<br/><br/><br/>

### NSSA / Totally NSSA<br/>

ASBR이 있는 경우 Stub으로 만들고 싶을 때 루핑에 문제가 생겨서 만들어 놓은 것이 NSSA 그리고 Totally NSSA.<br/><br/>

#### 명령어<br/>

R2)<br/>
```yaml
lo 0
ip add 2.2.2.2 255.255.255.0
router ospf 1
redistribute connected subnet
```
<br/><br/>

R3)<br/>
```yaml
lo 1
ip add 3.3.3.3 255.255.255.0
router ospf 1
redistribute connected subnet
```
<br/><br/>

R4)<br/>
```yaml
lo 1
ip add 4.4.4.4 255.255.255.0
router ospf 1
redistribute connected subnet
```
<br/><br/>

R3)<br/>
```yaml
router ospf 1
area 4 nssa default-information-originate
```
<br/><br/>

R4)<br/>
```yaml
router ospf 1
area 4 nssa
```
<br/><br/><br/>

#### 결과<br/>

사진첨부
<br/><br/>

사진첨부
<br/><br/>

### Totally NSSA<br/>

R2)<br/>

```yaml
lo 1
ip add 2.2.2.2 255.255.255.0
router ospf 1
redistribute connected subnet
```

<br/><br/>

R3)<br/>

```yaml
lo 1
ip add 3.3.3.3 255.255.255.0
router ospf 1
redistribute connected subnet
```

<br/><br/>

R4)<br/>

```yaml
lo 1
ip add 4.4.4.4 255.255.255.0
router ospf 1
redistribute connected subnet
```

<br/><br/>

R3)<br/>

```yaml
router ospf 1
area 4 nssa no-summary
```

<br/><br/>

R4)<br/>

```yaml
router ospf 1
area 4 nssa
```

<br/><br/>


- 결과<br/>

사진첨부
<br/><br/>

사진첨부
<br/><br/>


### NSSA no-redistribution<br/>

R2)<br/>

```yaml
lo 1
ip add 2.2.2.2 255.255.255.0
router ospf 1
redistribute connected subnet
```

<br/><br/>

R3)<br/>

```yaml
lo 1
ip add 3.3.3.3 255.255.255.0
router ospf 1
redistribute connected subnet
```

<br/><br/>

R4)<br/>

```yaml
lo 1
ip add 4.4.4.4 255.255.255.0
router ospf 1
redistribute connected subnet
```
<br/><br/>

R3)<br/>

```yaml
router ospf 1
area 4 nssa no-summary
area 4 nssa no-redistribution
```

<br/><br/>

R4)<br/>

```yaml
router ospf 1
area 4 nssa
```

<br/><br/>

- 결과<br/>

사진첨부
<br/><br/>

사진첨부
<br/><br/>

사진첨부
<br/><br/>

R1)<br/>

사진첨부
<br/><br/>

- aut0 = 인증 설정 X<br/>
- aut1 = 텍스트 인증 O<br/>
- aut2 = MD5 인증 O<br/><br/>


### Virtual-link<br/>

- 모든 Area는 반드시 Area 0에 연결되어 있어야 한다.<br/><br/>

사진첨부
<br/><br/>

#### 명령어<br/>

R2)<br/>

```yaml
router ospf 1
router-id 1.1.2.2
area 23 virtual-link 1.1.3.3
```

<br/><br/>

R3)<br/>

```yaml
router ospf 1
router-id 1.1.3.3
area 23 virtual-link 1.1.2.2
```

<br/><br/>

R2)<br/>

```yaml
# show ip ospf neighbor -> virtual-link가 보일 것임
```

<br/><br/>

R3)<br/>

```yaml
# show ip osp neighbor -> virtual-link가 보일 것임
```

<br/><br/>

논리적으로 R2, R3을 붙게 해 준 것.<br/><br/>


#### 결과<br/>

사진첨부
<br/><br/>

사진첨부
<br/><br/>

### Ex. Virtual-link<br/>

- 모든 loopback간의 통신이 다 되어야 함.<br/>

사진첨부
<br/><br/>

#### 방법 - Virtual-link<br/>

R2)<br/>

```yaml
router opsf 1
area 20 virtual-link 4.4.4.4
```

<br/><br/>

R4)<br/>

```yaml
router ospf 1
area 30 virtual-link 2.2.2.2
```

<br/><br/>

#### 오류<br/>

해결)<br/>

R4 - `area 20 virtual-link 2.2.2.2`<br/><br/>

#### 결과<br/>

R2)<br/>

사진첨부
<br/><br/>

사진첨부
<br/><br/>

사진첨부
<br/><br/>

### /32 -> /24<br/>

사진첨부
<br/><br/>

#### 명령어<br/>

```yaml
ip ospf network point-to-point
```

<br/><br/>

#### 결과<br/>

사진첨부
<br/><br/>

사진첨부
<br/><br/>

사진첨부
<br/><br/>

사진첨부
<br/><br/>

사진첨부
<br/><br/>

사진첨부
<br/><br/>


### # show ip ospf database<br/>

사진첨부
<br/><br/>

- Link ID = 라우터 ID<br/>
- ADV Router = 광고 라우터<br/><br/>

- 데이터베이스는 계층적으로 되어있다.<br/>
- 데이터베이스를 Area 별로 관리한다.<br/><br/>

R2)<br/>

사진첨부
<br/><br/>

R4, R5는 똑같은 AREA 속해 있어서 똑같은 속성을 가지고 있다.<br/>
